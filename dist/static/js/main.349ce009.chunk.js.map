{"version":3,"sources":["pages/index/components/Layout/style.module.scss","pages/nginx/components/Layout/style.module.scss","../external \"os\"","../external \"child_process\"","../external \"path\"","pages/nginx/components/Log/style.module.scss","../external \"electron\"","utils/index.js","pages/index/components/Layout/Context.jsx","pages/index/components/Layout/Item.jsx","utils/getDefaultPath.js","pages/index/components/Layout/index.jsx","pages/index/index.jsx","pages/index/effects/index.js","pages/nginx/components/Helper/index.jsx","hooks/useWatch.js","pages/nginx/components/Log/index.jsx","pages/nginx/components/Layout/index.jsx","pages/nginx/index.jsx","pages/nginx/effects/index.js","App.jsx","config.js","index.jsx","../external \"fs\""],"names":["module","exports","require","osType","os","type","isWin","normalize","str","trim","replace","storage","length","localStorage","getItem","setItem","delay","time","Promise","res","setTimeout","preventMutilClick","cb","timer","clearTimeout","checkFileExist","url","msg","rej","fs","access","err","error","readFile","content","toString","cmd","code","childProcess","exec","checkProcessById","id","writeFile","file","text","Context","createContext","EXT_REGEXP","Item","name","label","ext","onSelect","input","onChange","onPropsFocus","onFocus","onBlur","onRemove","required","rest","form","useContext","selectedItem","ipcRenderer","removeListener","onClick","match","send","defaultPath","getFieldValue","properties","filters","extensions","substr","on","validator","rule","value","val","matchValue","endsWith","includes","resolve","reject","rules","unshift","message","gutter","span","noStyle","validateTrigger","placeholder","e","target","select","autoComplete","MinusCircleOutlined","className","CONF","PID","ACCESS","ERROR","NGINX","getDefaultPath","nginxPath","nginx","conf","path","join","pid","FormItem","FormList","List","nginxName","formItemLayout","labelCol","sm","wrapperCol","style","buttonItemLayout","defaultLogs","Layout","useConnect","loadings","data","dispatch","nuomiProps","useNuomi","useForm","formRef","useRef","voidFields","setValues","setFields","forEach","field","setFieldsValue","setVoidFields","fields","getFieldsValue","Object","keys","push","clearVoidFields","Provider","onFinish","values","payload","initialValues","ref","extra","map","key","add","remove","index","offset","colon","current","scrollTop","onAdd","width","PlusOutlined","buttonItem","htmlType","loading","$saveNginx","confirm","onOk","clearFields","logs","edit","router","back","effects","save","newData","filter","this","updateState","JSON","stringify","init","parse","render","to","onInit","store","menu","title","shell","openExternal","Helper","props","overlay","placement","QuestionCircleOutlined","useWatch","args","useEffect","watcherPromise","a","extname","watch","watcher","close","Log","useState","setData","clearLoading","setClearLoading","scroller","onClear","onOpen","openItem","loadFile","array","split","slice","size","log","started","logFiles","useMemo","concat","reload","editConf","open","dirname","showItemInFolder","spinning","$checkStart","wrapperClassName","spin","card","bordered","danger","$stop","StopOutlined","$start","PlayCircleOutlined","ghost","$reload","ReloadOutlined","location","FileTextOutlined","FolderOpenOutlined","$delete","DeleteOutlined","k","state","getCode","getState","checkExist","App","locale","zhCN","cache","nuomi","config","duration","maxCount","listener","destroy","window","addEventListener","ctrlKey","keyCode","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.349ce009.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"form\":\"style_form__2a9bW\",\"buttonItem\":\"style_buttonItem__2bHJ8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"spin\":\"style_spin__1pnC9\",\"card\":\"style_card__3zz2B\"};","module.exports = require(\"os\");","module.exports = require(\"child_process\");","module.exports = require(\"path\");","// extracted by mini-css-extract-plugin\nmodule.exports = {\"log\":\"style_log__3TVDh\"};","module.exports = require(\"electron\");","import os from 'os';\r\nimport fs from 'fs';\r\nimport childProcess from 'child_process';\r\nimport { shell } from 'electron';\r\nimport { message } from 'antd';\r\n\r\nconst osType = os.type();\r\n\r\nexport const isMac = osType === 'Darwin';\r\n\r\nexport const isLinux = osType === 'Linux';\r\n\r\nexport const isWin = osType === 'Windows_NT';\r\n\r\nexport const normalize = (str) => (str ? str.trim().replace(/\\\\/g, '/') : '');\r\n\r\nexport const storage = (...args) => {\r\n  if (!args.length) {\r\n    return;\r\n  }\r\n  if (args.length === 1) {\r\n    return localStorage.getItem(args[0]);\r\n  }\r\n  return localStorage.setItem(args[0], args[1]);\r\n};\r\n\r\nexport const delay = (time = 300) => {\r\n  return new Promise((res) => {\r\n    setTimeout(() => res(), time);\r\n  });\r\n};\r\n\r\nexport const preventMutilClick = (cb) => {\r\n  let timer = null;\r\n  return () => {\r\n    clearTimeout(timer);\r\n    timer = setTimeout(() => {\r\n      cb && cb();\r\n    }, 100);\r\n  };\r\n};\r\n\r\nexport const checkFileExist = (url, msg) => {\r\n  return new Promise((res, rej) => {\r\n    fs.access(url, (err) => {\r\n      if (!err) {\r\n        res();\r\n      } else {\r\n        rej(msg || '文件不存在');\r\n        msg && message.error(msg);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport const readFile = (url) => {\r\n  return new Promise((res, rej) => {\r\n    fs.readFile(url, (err, content) => {\r\n      if (!err) {\r\n        res(content.toString());\r\n      } else {\r\n        rej();\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport const cmd = (code, msg) => {\r\n  return new Promise((res, rej) => {\r\n    childProcess.exec(code, (err) => {\r\n      if (!err) {\r\n        res();\r\n      } else {\r\n        rej(msg);\r\n        msg && message.error(msg);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport const checkProcessById = (id) => {\r\n  let code = 'lsof -nP -i | grep';\r\n  if (isWin) {\r\n    code = 'tasklist|findstr';\r\n  }\r\n  return cmd(`${code} ${id}`);\r\n};\r\n\r\nexport const writeFile = (file, text = '') => {\r\n  return new Promise((res, rej) => {\r\n    fs.writeFile(file, text, (err) => {\r\n      if (!err) {\r\n        res();\r\n      } else {\r\n        rej();\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport const openFolder = (path) => {\r\n  shell.showItemInFolder(isWin ? path.replace(/\\//g, '\\\\') : path);\r\n};\r\n","import { createContext } from 'react';\r\n\r\nconst Context = createContext();\r\n\r\nexport default Context;\r\n","import React, { useContext } from 'react';\r\nimport { Form, Input, Button, Row, Col } from 'antd';\r\nimport { MinusCircleOutlined } from '@ant-design/icons';\r\nimport { ipcRenderer } from 'electron';\r\nimport { checkFileExist, preventMutilClick } from '../../../../utils';\r\nimport Context from './Context';\r\n\r\nconst EXT_REGEXP = /\\.\\w+$/;\r\n\r\nconst Item = ({\r\n  name,\r\n  label,\r\n  ext,\r\n  input,\r\n  onSelect,\r\n  onChange,\r\n  onFocus: onPropsFocus,\r\n  onBlur,\r\n  onRemove,\r\n  required = true,\r\n  ...rest\r\n}) => {\r\n  const form = useContext(Context);\r\n\r\n  const selectedItem = (...args) => {\r\n    if (args[1]) {\r\n      onSelect(name, args[1]);\r\n    }\r\n    ipcRenderer.removeListener('selectedItem', selectedItem);\r\n  };\r\n\r\n  const onFocus = (e) => {\r\n    onPropsFocus && onPropsFocus(e);\r\n    e.target.select();\r\n  };\r\n\r\n  const onClick = preventMutilClick(() => {\r\n    const match = ext.match(EXT_REGEXP);\r\n    ipcRenderer.send('open-directory-dialog', {\r\n      defaultPath: form.getFieldValue(name),\r\n      properties: ['openFile'],\r\n      filters: [\r\n        {\r\n          name: 'All Files',\r\n          extensions: [match ? match[0].substr(1) : '*'],\r\n        },\r\n      ],\r\n    });\r\n    ipcRenderer.on('selectedItem', selectedItem);\r\n  });\r\n\r\n  const validator = (rule, value) => {\r\n    if (value) {\r\n      const val = value.trim();\r\n      const match = ext.match(EXT_REGEXP);\r\n      const matchValue = value.match(EXT_REGEXP);\r\n      if (match) {\r\n        if (val.endsWith(match[0])) {\r\n          if (['nginx', 'conf'].includes()) {\r\n            return checkFileExist(val);\r\n          }\r\n          return Promise.resolve();\r\n        }\r\n        return Promise.reject(`文件格式错误，必须以${match[0]}结尾`);\r\n      }\r\n      if (matchValue) {\r\n        return Promise.reject(`文件格式错误，不允许以${matchValue[0]}结尾`);\r\n      }\r\n      return checkFileExist(val);\r\n    }\r\n\r\n    return Promise.resolve();\r\n  };\r\n\r\n  const rules = [\r\n    () => ({\r\n      validator,\r\n    }),\r\n  ];\r\n\r\n  if (required) {\r\n    rules.unshift({ required: true, message: `${label}路径不能为空` });\r\n  }\r\n\r\n  return (\r\n    <Form.Item {...rest} label={label}>\r\n      <Row gutter={8}>\r\n        <Col span={19}>\r\n          <Form.Item name={name} noStyle rules={rules} validateTrigger=\"onBlur\">\r\n            <Input\r\n              placeholder={`请输入或选择${label}路径`}\r\n              onChange={onChange}\r\n              onFocus={onFocus}\r\n              onBlur={onBlur}\r\n              autoComplete=\"off\"\r\n            />\r\n          </Form.Item>\r\n        </Col>\r\n        <Col span={5}>\r\n          <Button onClick={onClick}>选 择</Button>\r\n          {onRemove ? <MinusCircleOutlined onClick={onRemove} className=\"e-ml8\" /> : ''}\r\n        </Col>\r\n      </Row>\r\n    </Form.Item>\r\n  );\r\n};\r\n\r\nexport default Item;\r\n","import path from 'path';\r\nimport { isWin } from '.';\r\n\r\nconst CONF = './nginx.conf';\r\nconst PID = './nginx.pid';\r\nconst ACCESS = './access.log';\r\nconst ERROR = './error.log';\r\nconst NGINX = isWin ? '' : '/usr/local/bin/nginx';\r\n\r\nconst getDefaultPath = (nginxPath = NGINX) => {\r\n  const defaultPath = {};\r\n  if (nginxPath) {\r\n    defaultPath.nginx = nginxPath;\r\n    if (isWin) {\r\n      defaultPath.conf = path.join(nginxPath, '../conf', CONF);\r\n      defaultPath.pid = path.join(nginxPath, '../logs', PID);\r\n      defaultPath.access = path.join(nginxPath, '../logs', ACCESS);\r\n      defaultPath.error = path.join(nginxPath, '../logs', ERROR);\r\n    } else {\r\n      defaultPath.conf = path.join(nginxPath, '../../etc/nginx', CONF);\r\n      defaultPath.pid = path.join(nginxPath, '../../var/run', PID);\r\n      defaultPath.access = path.join(nginxPath, '../../var/log/nginx', ACCESS);\r\n      defaultPath.error = path.join(nginxPath, '../../var/log/nginx', ERROR);\r\n    }\r\n  }\r\n  return defaultPath;\r\n};\r\n\r\nexport default getDefaultPath;\r\n","import React, { useRef } from 'react';\r\nimport { useConnect, useNuomi, router } from 'nuomi';\r\nimport { Form, Button, Modal, Row, Col } from 'antd';\r\nimport { PlusOutlined } from '@ant-design/icons';\r\nimport Item from './Item';\r\nimport { isWin } from '../../../../utils';\r\nimport getDefaultPath from '../../../../utils/getDefaultPath';\r\nimport Context from './Context';\r\nimport style from './style.module.scss';\r\n\r\nconst FormItem = Form.Item;\r\nconst FormList = Form.List;\r\nconst nginxName = `nginx${isWin ? '.exe' : ''}`;\r\n\r\nconst formItemLayout = {\r\n  labelCol: {\r\n    sm: { span: 4 },\r\n  },\r\n  wrapperCol: {\r\n    sm: { span: 20 },\r\n  },\r\n  className: style.form,\r\n};\r\n\r\nconst buttonItemLayout = {\r\n  labelCol: {\r\n    sm: { span: 0 },\r\n  },\r\n  wrapperCol: {\r\n    sm: { span: 24 },\r\n  },\r\n};\r\n\r\nconst defaultLogs = [\r\n  {\r\n    name: 'access',\r\n    label: 'Access Log',\r\n  },\r\n  {\r\n    name: 'error',\r\n    label: 'Error Log',\r\n  },\r\n];\r\n\r\nconst Layout = () => {\r\n  const [{ loadings, ...data }, dispatch] = useConnect();\r\n  const { nuomiProps } = useNuomi();\r\n  const [form] = Form.useForm();\r\n  const formRef = useRef();\r\n  let voidFields = null;\r\n\r\n  const onFinish = (values) => {\r\n    dispatch({\r\n      type: '$saveNginx',\r\n      payload: values,\r\n    });\r\n  };\r\n\r\n  const onBack = () => {\r\n    router.back();\r\n  };\r\n\r\n  const onReset = () => {\r\n    Modal.confirm({\r\n      content: '确定要清空吗？',\r\n      onOk: () => {\r\n        const clearFields = {};\r\n        ['nginx', 'conf', 'pid', 'access', 'error'].forEach((value) => {\r\n          clearFields[value] = '';\r\n        });\r\n        form.setFieldsValue({\r\n          ...clearFields,\r\n          logs: [],\r\n        });\r\n      },\r\n    });\r\n  };\r\n\r\n  const setValues = (path) => {\r\n    if (voidFields) {\r\n      const setFields = {};\r\n      const defaultPath = getDefaultPath(path);\r\n      voidFields.forEach((field) => {\r\n        setFields[field] = defaultPath[field];\r\n      });\r\n      form.setFieldsValue(setFields);\r\n    }\r\n  };\r\n\r\n  const setVoidFields = () => {\r\n    const fields = form.getFieldsValue();\r\n    Object.keys(fields).forEach((value) => {\r\n      if (!['nginx', 'logs'].includes(value) && !fields[value]) {\r\n        if (!voidFields) {\r\n          voidFields = [];\r\n        }\r\n        voidFields.push(value);\r\n      }\r\n    });\r\n  };\r\n\r\n  const clearVoidFields = () => {\r\n    voidFields = null;\r\n  };\r\n\r\n  const onSelect = (name, path) => {\r\n    form.setFieldsValue({\r\n      [name]: path,\r\n    });\r\n    if (name === 'nginx') {\r\n      setVoidFields();\r\n      setValues(path);\r\n      clearVoidFields();\r\n    }\r\n  };\r\n\r\n  const onNginxChange = ({ target: { value } }) => {\r\n    setValues(value);\r\n  };\r\n\r\n  const onAdd = (add) => {\r\n    add();\r\n    setTimeout(() => {\r\n      formRef.current.scrollTop = 19920604;\r\n    }, 0);\r\n  };\r\n\r\n  return (\r\n    <Context.Provider value={form}>\r\n      <Form form={form} onFinish={onFinish} {...formItemLayout} initialValues={data}>\r\n        <div ref={formRef}>\r\n          <Item\r\n            extra={`选择${nginxName}后，其他项路径会被自动填充，如果错误请自行修改`}\r\n            name=\"nginx\"\r\n            label=\"Nginx\"\r\n            ext={isWin ? '.exe' : ''}\r\n            onSelect={onSelect}\r\n            onChange={onNginxChange}\r\n            onFocus={setVoidFields}\r\n            onBlur={clearVoidFields}\r\n          />\r\n          <Item name=\"conf\" label=\"Conf\" ext=\".conf\" onSelect={onSelect} />\r\n          <Item name=\"pid\" label=\"Pid\" ext=\".pid\" onSelect={onSelect} />\r\n          {defaultLogs.map(({ name, label }) => (\r\n            <Item\r\n              key={name}\r\n              name={name}\r\n              label={label}\r\n              ext=\".log\"\r\n              onSelect={onSelect}\r\n              required={false}\r\n            />\r\n          ))}\r\n          <FormList name=\"logs\">\r\n            {(fields, { add, remove }) => {\r\n              return (\r\n                <>\r\n                  {fields.map((field, index) => (\r\n                    <Item\r\n                      {...field}\r\n                      label={index === 0 ? 'Other Log' : ''}\r\n                      wrapperCol={index === 0 ? null : { sm: { offset: 4, span: 20 } }}\r\n                      ext=\".log\"\r\n                      onRemove={() => remove(field.name)}\r\n                      onSelect={onSelect}\r\n                      required={false}\r\n                    />\r\n                  ))}\r\n                  <FormItem label=\" \" colon={false} required={false} className=\"e-mb8\">\r\n                    <Row gutter={8}>\r\n                      <Col span={19}>\r\n                        <Button type=\"dashed\" onClick={() => onAdd(add)} style={{ width: '100%' }}>\r\n                          <PlusOutlined /> 新增日志项\r\n                        </Button>\r\n                      </Col>\r\n                    </Row>\r\n                  </FormItem>\r\n                </>\r\n              );\r\n            }}\r\n          </FormList>\r\n          <FormItem className={style.buttonItem} {...buttonItemLayout}>\r\n            <Button type=\"primary\" htmlType=\"submit\" loading={loadings.$saveNginx}>\r\n              进入应用\r\n            </Button>\r\n            <Button onClick={onReset} className=\"e-ml16\">\r\n              清 空\r\n            </Button>\r\n            {nuomiProps.data.edit && (\r\n              <Button onClick={onBack} className=\"e-ml16\">\r\n                返 回\r\n              </Button>\r\n            )}\r\n          </FormItem>\r\n        </div>\r\n      </Form>\r\n    </Context.Provider>\r\n  );\r\n};\r\n\r\nexport default Layout;\r\n","import React from 'react';\r\nimport { Redirect } from 'nuomi';\r\nimport Layout from './components/Layout';\r\nimport { storage } from '../../utils';\r\nimport effects from './effects';\r\n\r\nexport default {\r\n  data: {\r\n    // 是否是编辑状态\r\n    edit: false,\r\n  },\r\n  effects,\r\n  render() {\r\n    if (this.data.edit || !storage('nginx')) {\r\n      return <Layout />;\r\n    }\r\n    return <Redirect to=\"/nginx\" />;\r\n  },\r\n  onInit() {\r\n    this.store.dispatch({\r\n      type: 'init',\r\n    });\r\n  },\r\n};\r\n","import { router } from 'nuomi';\r\nimport { storage, normalize, delay } from '../../../utils';\r\nimport getDefaultPath from '../../../utils/getDefaultPath';\r\n\r\nexport default {\r\n  save(data) {\r\n    const newData = {};\r\n    Object.keys(data).forEach((key) => {\r\n      const value = data[key];\r\n      if (key !== 'logs') {\r\n        newData[key] = normalize(value);\r\n      } else if (value) {\r\n        newData[key] = value.map((path) => normalize(path)).filter((path) => path);\r\n      }\r\n    });\r\n    this.updateState(newData);\r\n    storage('nginx', JSON.stringify(newData));\r\n  },\r\n  async $saveNginx(data) {\r\n    this.save(data);\r\n    await delay();\r\n    router.replace('/nginx', true);\r\n  },\r\n  init() {\r\n    const nginx = storage('nginx');\r\n    this.updateState(nginx ? JSON.parse(nginx) : getDefaultPath());\r\n  },\r\n};\r\n","import React from 'react';\r\nimport { QuestionCircleOutlined } from '@ant-design/icons';\r\nimport { Menu, Dropdown } from 'antd';\r\nimport { shell } from 'electron';\r\n\r\nconst menus = [\r\n  {\r\n    url: 'https://github.com/yinjiazeng/NginxGUI/issues',\r\n    title: '常见问题',\r\n  },\r\n  {\r\n    url: 'https://github.com/yinjiazeng/NginxGUI/issues/new',\r\n    title: '建议反馈',\r\n  },\r\n  {\r\n    url: 'https://github.com/yinjiazeng/NginxGUI/blob/master/README.md',\r\n    title: '关于NginxGUI',\r\n  },\r\n];\r\n\r\nconst menu = (\r\n  <Menu>\r\n    {menus.map(({ url, title }) => (\r\n      <Menu.Item key={title}>\r\n        <a onClick={() => shell.openExternal(url)}>{title}</a>\r\n      </Menu.Item>\r\n    ))}\r\n  </Menu>\r\n);\r\n\r\nconst Helper = (props) => {\r\n  return (\r\n    <Dropdown overlay={menu} placement=\"bottomRight\">\r\n      <QuestionCircleOutlined {...props} />\r\n    </Dropdown>\r\n  );\r\n};\r\n\r\nexport default Helper;\r\n","import { useEffect } from 'react';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport { checkFileExist, writeFile, preventMutilClick } from '../utils';\r\n\r\nexport const useWatch = (cb, args) => {\r\n  useEffect(() => {\r\n    const watch = async () => {\r\n      const file = args[0];\r\n      if (!file) {\r\n        return null;\r\n      }\r\n      const ext = path.extname(file);\r\n      // 不存在先创建\r\n      if (ext === '.log') {\r\n        try {\r\n          await checkFileExist(file);\r\n        } catch (e) {\r\n          await writeFile(file, '');\r\n        }\r\n      }\r\n      try {\r\n        return fs.watch(file, preventMutilClick(cb));\r\n      } catch (e) {\r\n        //\r\n      }\r\n    };\r\n    const watcherPromise = watch();\r\n    return async () => {\r\n      const watcher = await watcherPromise;\r\n      watcher && watcher.close();\r\n    };\r\n  }, args);\r\n};\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { Button, Card } from 'antd';\r\nimport { shell } from 'electron';\r\nimport { useWatch } from '../../../../hooks';\r\nimport { readFile, checkFileExist, writeFile, preventMutilClick } from '../../../../utils';\r\nimport style from './style.module.scss';\r\n\r\nconst Log = ({ file }) => {\r\n  const [data, setData] = useState([]);\r\n  const [clearLoading, setClearLoading] = useState(false);\r\n  const scroller = useRef();\r\n\r\n  const onClear = preventMutilClick(async () => {\r\n    await checkFileExist(file, '日志文件不存在');\r\n    setClearLoading(true);\r\n    await writeFile(file, '');\r\n    setData([]);\r\n    setClearLoading(false);\r\n  });\r\n\r\n  const onOpen = preventMutilClick(async () => {\r\n    await checkFileExist(file, '日志文件不存在');\r\n    shell.openItem(file);\r\n  });\r\n\r\n  const loadFile = async () => {\r\n    const content = await readFile(file);\r\n    const array = content.split(/\\n/g).slice(-100);\r\n    setData(array.filter((text) => text.trim()));\r\n    if (scroller.current) {\r\n      scroller.current.scrollTop = 19920604;\r\n    }\r\n  };\r\n\r\n  useWatch(() => {\r\n    loadFile();\r\n  }, [file]);\r\n\r\n  useEffect(() => {\r\n    loadFile();\r\n  }, []);\r\n\r\n  return (\r\n    <Card\r\n      title={file}\r\n      extra={\r\n        <>\r\n          <Button size=\"small\" onClick={onOpen}>\r\n            全部日志\r\n          </Button>\r\n          <Button size=\"small\" className=\"e-ml8\" onClick={onClear} loading={clearLoading}>\r\n            清除日志\r\n          </Button>\r\n        </>\r\n      }\r\n      className={style.log}\r\n    >\r\n      <div ref={scroller}>\r\n        {data.map((text, key) => (\r\n          <p key={key}>{text}</p>\r\n        ))}\r\n      </div>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default Log;\r\n","import React, { useMemo } from 'react';\r\nimport { Card, Spin, Button } from 'antd';\r\nimport { shell } from 'electron';\r\nimport path from 'path';\r\nimport {\r\n  StopOutlined,\r\n  FolderOpenOutlined,\r\n  FileTextOutlined,\r\n  DeleteOutlined,\r\n  ReloadOutlined,\r\n  PlayCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport { useConnect, router } from 'nuomi';\r\nimport Helper from '../Helper';\r\nimport Log from '../Log';\r\nimport { useWatch } from '../../../../hooks';\r\nimport { checkFileExist, preventMutilClick, openFolder } from '../../../../utils';\r\nimport style from './style.module.scss';\r\n\r\nconst Layout = () => {\r\n  const [{ loadings, started, nginx, conf, error, access, logs }, dispatch] = useConnect();\r\n\r\n  const logFiles = useMemo(() => {\r\n    return [access, error].concat(logs || []);\r\n  }, [access, error, logs]);\r\n\r\n  const stop = () => {\r\n    dispatch({ type: '$stop' });\r\n  };\r\n\r\n  const start = () => {\r\n    dispatch({ type: '$start' });\r\n  };\r\n\r\n  const reload = () => {\r\n    dispatch({ type: '$reload' });\r\n  };\r\n\r\n  const remove = () => {\r\n    dispatch({ type: '$delete' });\r\n  };\r\n\r\n  const edit = () => {\r\n    router.location('/', { edit: true });\r\n  };\r\n\r\n  const editConf = preventMutilClick(async () => {\r\n    await checkFileExist(conf, 'conf文件不存在');\r\n    shell.openItem(conf);\r\n  });\r\n\r\n  const open = preventMutilClick(async () => {\r\n    await checkFileExist(path.dirname(nginx), '目录不存在');\r\n    openFolder(nginx);\r\n  });\r\n\r\n  useWatch(() => {\r\n    started && reload();\r\n  }, [conf, started]);\r\n\r\n  return (\r\n    <Spin spinning={loadings.$checkStart} wrapperClassName={style.spin}>\r\n      <Card\r\n        className={style.card}\r\n        bordered={false}\r\n        title={\r\n          <span>\r\n            {started ? (\r\n              <Button onClick={stop} danger loading={loadings.$stop}>\r\n                {!loadings.$stop && <StopOutlined />}\r\n                停止\r\n              </Button>\r\n            ) : (\r\n              <Button type=\"primary\" onClick={start} loading={loadings.$start}>\r\n                {!loadings.$start && <PlayCircleOutlined />}\r\n                启动\r\n              </Button>\r\n            )}\r\n            {started && (\r\n              <Button\r\n                className=\"e-ml8\"\r\n                onClick={reload}\r\n                type=\"primary\"\r\n                ghost\r\n                loading={loadings.$reload}\r\n              >\r\n                {!loadings.$reload && <ReloadOutlined />}\r\n                重启\r\n              </Button>\r\n            )}\r\n          </span>\r\n        }\r\n        extra={\r\n          <span>\r\n            <Button onClick={edit}>\r\n              <FileTextOutlined />\r\n              编辑路径\r\n            </Button>\r\n            <Button onClick={editConf} className=\"e-ml8\">\r\n              <FileTextOutlined />\r\n              编辑配置\r\n            </Button>\r\n            <Button onClick={open} className=\"e-ml8\">\r\n              <FolderOpenOutlined />\r\n              打开目录\r\n            </Button>\r\n            <Button onClick={remove} className=\"e-ml8\" type=\"danger\" loading={loadings.$delete}>\r\n              {!loadings.$delete && <DeleteOutlined />}\r\n              删除\r\n            </Button>\r\n            <Helper className=\"e-ml8\" />\r\n          </span>\r\n        }\r\n      >\r\n        {logFiles.map((log, k) => (\r\n          <Log file={log} key={`${log || ''}_${k}`} />\r\n        ))}\r\n      </Card>\r\n    </Spin>\r\n  );\r\n};\r\n\r\nexport default Layout;\r\n","import React from 'react';\r\nimport { Redirect } from 'nuomi';\r\nimport Layout from './components/Layout';\r\nimport effects from './effects';\r\nimport { storage } from '../../utils';\r\n\r\nexport default {\r\n  state: {\r\n    nginx: '',\r\n    conf: '',\r\n    pid: '',\r\n    access: '',\r\n    error: '',\r\n    logs: [],\r\n    // 是否启动\r\n    started: false,\r\n  },\r\n  effects,\r\n  render() {\r\n    return !storage('nginx') ? <Redirect to=\"/\" /> : <Layout />;\r\n  },\r\n  onInit() {\r\n    this.store.dispatch({\r\n      type: '$checkStart',\r\n    });\r\n  },\r\n};\r\n","import { router } from 'nuomi';\r\nimport path from 'path';\r\nimport {\r\n  storage,\r\n  readFile,\r\n  checkProcessById,\r\n  cmd,\r\n  checkFileExist,\r\n  delay,\r\n  isWin,\r\n} from '../../../utils';\r\n\r\nexport default {\r\n  getCode(code) {\r\n    const { nginx, conf } = this.getState();\r\n    // nginx -c conf -s signal -p prefix\r\n    return `\"${nginx}\" -c \"${conf}\"${code}${isWin ? ` -p \"${path.dirname(nginx)}\"` : ''}`;\r\n  },\r\n  async checkExist() {\r\n    const { nginx, conf } = this.getState();\r\n    await checkFileExist(nginx, 'nginx文件不存在');\r\n    await checkFileExist(conf, 'conf文件不存在');\r\n  },\r\n  // 执行命令\r\n  async cmd(code, msg) {\r\n    await this.checkExist();\r\n    await cmd(this.getCode(code), msg);\r\n  },\r\n  // 启动nginx\r\n  async $start() {\r\n    // windows 启动命令不会退出，所以不会执行Promise回调\r\n    if (isWin) {\r\n      await this.checkExist();\r\n      cmd(this.getCode(''));\r\n    } else {\r\n      await this.cmd('', '启动失败');\r\n    }\r\n    await delay();\r\n    this.updateState({ started: true });\r\n  },\r\n  // 停止nginx\r\n  async $stop() {\r\n    await this.cmd(` -s stop`, '停止失败');\r\n    await delay();\r\n    this.updateState({ started: false });\r\n  },\r\n  // 重启nginx\r\n  async $reload() {\r\n    await delay();\r\n    await this.cmd(` -s reload`, '重启失败');\r\n  },\r\n  // 删除nginx\r\n  async $delete() {\r\n    const { started } = this.getState();\r\n    if (started) {\r\n      await this.$stop();\r\n    }\r\n    storage('nginx', '');\r\n    router.replace('/');\r\n  },\r\n  // 根据pid检测nginx是否已经启动\r\n  async $checkStart() {\r\n    const nginx = storage('nginx');\r\n    const state = nginx ? JSON.parse(nginx) : this.state;\r\n    try {\r\n      await delay(100);\r\n      const id = await readFile(state.pid);\r\n      await checkProcessById(id);\r\n      this.updateState({ ...state, started: true });\r\n    } catch (e) {\r\n      this.updateState(state);\r\n    }\r\n  },\r\n};\r\n","import React from 'react';\r\nimport { Router, Route } from 'nuomi';\r\nimport { ConfigProvider } from 'antd';\r\nimport zhCN from 'antd/es/locale/zh_CN';\r\nimport index from './pages/index';\r\nimport nginx from './pages/nginx';\r\nimport './assets/style.scss';\r\n\r\nconst App = () => {\r\n  return (\r\n    <ConfigProvider locale={zhCN}>\r\n      <Router>\r\n        <Route path=\"/\" {...index} />\r\n        <Route path=\"/nginx\" cache {...nginx} />\r\n      </Router>\r\n    </ConfigProvider>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","import { message } from 'antd';\r\nimport { nuomi, router } from 'nuomi';\r\n\r\nnuomi.config({\r\n  effects: {\r\n    updateState(payload) {\r\n      this.dispatch({\r\n        type: '_updateState',\r\n        payload,\r\n      });\r\n    },\r\n  },\r\n});\r\n\r\nmessage.config({\r\n  duration: 2,\r\n  maxCount: 3,\r\n});\r\n\r\nrouter.listener(() => {\r\n  message.destroy();\r\n});\r\n\r\nwindow.addEventListener('keydown', (e) => {\r\n  if (e.ctrlKey && e.keyCode === 116) {\r\n    window.location.reload();\r\n  }\r\n});\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport './config';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n","module.exports = require(\"fs\");"],"sourceRoot":""}